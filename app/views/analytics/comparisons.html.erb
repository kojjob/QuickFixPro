<div class="min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50" data-controller="analytics-comparisons">
  <!-- Enhanced Header -->
  <div class="relative bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 shadow-xl">
    <div class="absolute inset-0 bg-black opacity-10"></div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="flex items-center justify-between">
        <div>
          <nav class="flex items-center text-white/80 text-sm mb-2">
            <%= link_to "Analytics", analytics_path, class: "hover:text-white transition-colors" %>
            <svg class="w-4 h-4 mx-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
            <span class="text-white">Website Comparison</span>
          </nav>
          <h1 class="text-4xl font-bold text-white tracking-tight flex items-center">
            <svg class="w-10 h-10 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
            Website Comparison
          </h1>
          <p class="mt-2 text-green-100 text-lg">Compare performance metrics across your websites</p>
        </div>
        
        <!-- Metric Selector -->
        <div class="flex items-center space-x-4">
          <form method="get" action="<%= analytics_comparisons_path %>" class="flex items-center space-x-2">
            <select name="metrics[]" multiple 
                    class="bg-white/20 backdrop-blur-sm text-white placeholder-white/60 border-white/30 rounded-lg px-4 py-2 focus:ring-2 focus:ring-white/50"
                    onchange="this.form.submit()">
              <option value="overall_score" <%= 'selected' if @comparison_metrics.include?('overall_score') %>>Overall Score</option>
              <option value="lcp" <%= 'selected' if @comparison_metrics.include?('lcp') %>>LCP</option>
              <option value="fcp" <%= 'selected' if @comparison_metrics.include?('fcp') %>>FCP</option>
              <option value="cls" <%= 'selected' if @comparison_metrics.include?('cls') %>>CLS</option>
              <option value="ttfb" <%= 'selected' if @comparison_metrics.include?('ttfb') %>>TTFB</option>
              <option value="fid" <%= 'selected' if @comparison_metrics.include?('fid') %>>FID</option>
            </select>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Industry Benchmarks -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl shadow-lg p-6 mb-8 text-white">
      <h3 class="text-lg font-semibold mb-4 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        Industry Benchmarks
      </h3>
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <% @benchmarks.each do |metric, values| %>
          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3">
            <p class="text-xs text-white/80 uppercase tracking-wider mb-1"><%= metric.to_s.upcase %></p>
            <div class="space-y-1">
              <div class="flex items-center justify-between text-xs">
                <span class="text-green-200">Good</span>
                <span class="font-medium"><%= values[:good] %><%= metric == :cls ? '' : metric == :overall_score ? '%' : 'ms' %></span>
              </div>
              <div class="flex items-center justify-between text-xs">
                <span class="text-yellow-200">Needs Work</span>
                <span class="font-medium"><%= values[:needs_improvement] %><%= metric == :cls ? '' : metric == :overall_score ? '%' : 'ms' %></span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Comparison Table -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
      <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-8 py-6 border-b border-gray-200">
        <h3 class="text-xl font-bold text-gray-900 flex items-center">
          <svg class="w-6 h-6 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
          </svg>
          Side-by-Side Comparison
        </h3>
      </div>
      
      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
              <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky left-0 bg-gray-50 z-10">
                Website
              </th>
              <% @comparison_metrics.each do |metric| %>
                <th class="px-6 py-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                  <%= metric.humanize %>
                </th>
              <% end %>
              <th class="px-6 py-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                Rank
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% if @comparison_data.any? %>
              <% 
                # Calculate ranks based on overall score
                sorted_sites = @comparison_data.sort_by { |_, data| -(data['overall_score'] || 0) }
                ranks = {}
                sorted_sites.each_with_index { |(id, _), idx| ranks[id] = idx + 1 }
              %>
              
              <% @comparison_data.each do |website_id, data| %>
                <tr class="hover:bg-gray-50 transition-colors">
                  <td class="px-6 py-4 whitespace-nowrap sticky left-0 bg-white z-10">
                    <div>
                      <p class="text-sm font-medium text-gray-900"><%= data[:name] %></p>
                      <p class="text-xs text-gray-500"><%= data[:url] %></p>
                    </div>
                  </td>
                  
                  <% @comparison_metrics.each do |metric| %>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                      <% value = data[metric] %>
                      <% if value %>
                        <% 
                          benchmark = @benchmarks[metric.to_sym] || {}
                          if metric == 'overall_score'
                            status = value >= 90 ? 'good' : value >= 50 ? 'needs-improvement' : 'poor'
                          elsif metric == 'cls'
                            status = value <= (benchmark[:good] || 0.1) ? 'good' : value <= (benchmark[:needs_improvement] || 0.25) ? 'needs-improvement' : 'poor'
                          else
                            status = value <= (benchmark[:good] || 2500) ? 'good' : value <= (benchmark[:needs_improvement] || 4000) ? 'needs-improvement' : 'poor'
                          end
                          
                          status_colors = {
                            'good' => 'green',
                            'needs-improvement' => 'yellow',
                            'poor' => 'red'
                          }
                          color = status_colors[status] || 'gray'
                        %>
                        
                        <div class="relative">
                          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-<%= color %>-100 text-<%= color %>-800">
                            <%= value %>
                            <% if metric == 'overall_score' %>
                              %
                            <% elsif metric != 'cls' %>
                              ms
                            <% end %>
                          </span>
                          
                          <!-- Visual indicator -->
                          <div class="absolute -top-1 -right-1">
                            <% if status == 'good' %>
                              <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                              </svg>
                            <% elsif status == 'poor' %>
                              <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                              </svg>
                            <% end %>
                          </div>
                        </div>
                      <% else %>
                        <span class="text-gray-400">â€”</span>
                      <% end %>
                    </td>
                  <% end %>
                  
                  <td class="px-6 py-4 whitespace-nowrap text-center">
                    <% rank = ranks[website_id] %>
                    <% rank_color = rank == 1 ? 'yellow' : rank == 2 ? 'gray' : rank == 3 ? 'orange' : 'gray' %>
                    <div class="inline-flex items-center">
                      <% if rank <= 3 %>
                        <svg class="w-6 h-6 text-<%= rank_color %>-500" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                      <% end %>
                      <span class="<%= rank <= 3 ? 'ml-1' : '' %> text-lg font-bold text-gray-700">#<%= rank %></span>
                    </div>
                  </td>
                </tr>
              <% end %>
            <% else %>
              <tr>
                <td colspan="<%= @comparison_metrics.length + 2 %>" class="px-6 py-12 text-center text-gray-500">
                  <svg class="w-16 h-16 text-gray-300 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                  </svg>
                  <p>No comparison data available</p>
                  <p class="text-sm mt-1">Run audits on your websites to see comparisons</p>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Visual Comparison Chart -->
    <div class="bg-white rounded-2xl shadow-lg p-8">
      <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
        <svg class="w-6 h-6 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/>
        </svg>
        Visual Performance Comparison
      </h3>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Radar Chart Placeholder -->
        <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-8 flex items-center justify-center h-64">
          <div class="text-center">
            <svg class="w-20 h-20 text-indigo-300 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/>
            </svg>
            <p class="text-sm text-gray-600">Radar chart comparing all metrics</p>
            <p class="text-xs text-gray-400 mt-1">Visualization of relative performance</p>
          </div>
        </div>
        
        <!-- Performance Distribution -->
        <div class="space-y-4">
          <h4 class="text-sm font-semibold text-gray-700 uppercase tracking-wider">Performance Distribution</h4>
          
          <% if @comparison_data.any? %>
            <% 
              scores = @comparison_data.map { |_, data| data['overall_score'] }.compact
              excellent = scores.count { |s| s >= 90 }
              good = scores.count { |s| s >= 70 && s < 90 }
              needs_work = scores.count { |s| s >= 50 && s < 70 }
              poor = scores.count { |s| s < 50 }
              total = scores.length
            %>
            
            <div class="space-y-3">
              <% [
                { label: "Excellent (90-100)", count: excellent, color: "green" },
                { label: "Good (70-89)", count: good, color: "blue" },
                { label: "Needs Work (50-69)", count: needs_work, color: "yellow" },
                { label: "Poor (<50)", count: poor, color: "red" }
              ].each do |category| %>
                <div>
                  <div class="flex items-center justify-between mb-1">
                    <span class="text-sm font-medium text-gray-700"><%= category[:label] %></span>
                    <span class="text-sm text-gray-500"><%= category[:count] %> sites</span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-3">
                    <% percentage = total > 0 ? (category[:count].to_f / total * 100) : 0 %>
                    <div class="bg-<%= category[:color] %>-500 h-3 rounded-full transition-all duration-500" 
                         style="width: <%= percentage %>%"></div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-sm text-gray-500">No data to display</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>